<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Form</title>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Parsley JS -->
    <script src="https://parsleyjs.org/dist/parsley.min.js"></script>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      input.parsley-success,
      select.parsley-success,
      textarea.parsley-success {
        color: #468847;
        background-color: #dff0d8;
        border: 1px solid #468847;
      }
      input.parsley-error,
      select.parsley-error,
      textarea.parsley-error {
        color: #b94a48;
        background-color: #f2dede;
        border: 1px solid #b94a48;
      }
      .hidden {
        display: none;
      }
      .bs-callout {
        /* Kleine Infobox für Warning  */
        padding: 15px;
        margin-top: 10px;
        border: 1px solid #eee;
        border-left-width: 5px;
        border-radius: 3px;
      }
      .bs-callout-warning {
        border-left-color: #f0ad4e;
      }
      .bs-callout-info {
        border-left-color: #5bc0de;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Feedback Callouts -->
      <div class="bs-callout bs-callout-warning hidden">
        <h4>Oh snap!</h4>
        <p>This form seems to be invalid :(</p>
      </div>

      <div class="bs-callout bs-callout-info hidden">
        <h4>Yay!</h4>
        <p>Everything seems to be ok :)</p>
      </div>

      <!-- Formular -->
      <form id="demo-form" data-parsley-validate>
        <!-- Data-parsley-validate: Parsley aktiviert die Validierung automatisch beim Submit. -->
        <div class="form-group">
          <label for="fullname">Full Name * :</label>
          <input
            type="text"
            id="fullname"
            class="form-control"
            name="fullname"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email * :</label>
          <input
            type="email"
            id="email"
            class="form-control"
            name="email"
            required
            data-parsley-trigger="change"
          />
        </div>

        <div class="form-group">
          <label for="file"
            >Please provide a PNG or JPG image smaller than 42Kb:</label
          >
          <input
            type="file"
            id="file"
            class="form-control"
            name="file"
            required
            data-parsley-maxFileSize="42"
            data-parsley-fileType="png,jpg"
            accept=".png,.jpg"
          />
        </div>

        <div class="form-group">
          <label>Preferred Contact Method *:</label><br />
          Email
          <input
            type="radio"
            name="contactMethod"
            value="Email"
            required
            data-parsley-multiple="contactMethod"
          />
          <!-- data-parsley-multiple="contactMethod" → Parsley weiß, dass mehrere Radios zu einer Gruppe gehören. -->
          Phone
          <input
            type="radio"
            name="contactMethod"
            value="Phone"
            data-parsley-multiple="contactMethod"
          />
        </div>

        <div class="form-group">
          <label>Hobbies (Optional, but 2 minimum):</label><br />
          Skiing
          <input
            type="checkbox"
            name="hobbies[]"
            value="ski"
            data-parsley-mincheck="2"
            data-parsley-multiple="hobbies"
          /><br />
          Running
          <input
            type="checkbox"
            name="hobbies[]"
            value="run"
            data-parsley-multiple="hobbies"
          /><br />
          Eating
          <input
            type="checkbox"
            name="hobbies[]"
            value="eat"
            data-parsley-multiple="hobbies"
          /><br />
          Sleeping
          <input
            type="checkbox"
            name="hobbies[]"
            value="sleep"
            data-parsley-multiple="hobbies"
          /><br />
          Reading
          <input
            type="checkbox"
            name="hobbies[]"
            value="read"
            data-parsley-multiple="hobbies"
          /><br />
          Coding
          <input
            type="checkbox"
            name="hobbies[]"
            value="code"
            data-parsley-multiple="hobbies"
          /><br />
        </div>

        <div class="form-group">
          <label for="heard">Heard about us via *:</label>
          <select id="heard" class="form-control" required>
            <option value="">Choose..</option>
            <option value="press">Press</option>
            <option value="net">Internet</option>
            <option value="mouth">Word of mouth</option>
            <option value="other">Other..</option>
          </select>
        </div>

        <div class="form-group">
          <label for="message">Message (20 chars min, 100 max) :</label>
          <textarea
            id="message"
            class="form-control"
            name="message"
            data-parsley-minlength="20"
            data-parsley-maxlength="100"
            data-parsley-minlength-message="Come on! You need to enter at least a 20 character comment.."
            data-parsley-validation-threshold="10"
          ></textarea>
        </div>

        <input type="submit" class="btn btn-default" value="Validate" />
      </form>
    </div>

    <script>
      // Parsley Setup
      $(function () {
        $("#demo-form")
          .parsley()
          .on("field:validated", function () {
            var ok = $(".parsley-error").length === 0;
            $(".bs-callout-info").toggleClass("hidden", !ok);
            $(".bs-callout-warning").toggleClass("hidden", ok);
          })
          .on("form:submit", function () {
            return false;
          });
      });

      // Validator für maximale Dateigröße
      window.Parsley.addValidator("maxFileSize", {
        validateString: function (_value, maxSize, parsleyInstance) {
          // parsleyInstance = aktuelle Parsley-Objekt - _value weil es nicht genutzt wird gerade
          if (!window.FormData) return true;
          var files = parsleyInstance.$element[0].files; // [0] = echtes DOM-Element. und parsleyInstance.$element → jQuery-ähnliches Objekt, das auf das Input-Feld zeigt.
          return !files.length || files[0].size <= maxSize * 1024;
          //files[0] die erste Datei weil man im Formular nur eine Datei hochladen darf.
        },
        requirementType: "integer",
        messages: { en: "This file should not be larger than %s Kb" }, // %s wird durch maxSize ersetzt
      });

      // add.Validator = fügt Parsley einen benutzerdefinierten Validator hinzu.
      // Validator für Dateityp PNG/JPG
      window.Parsley.addValidator("fileType", {
        validateString: function (_value, allowedTypes, parsleyInstance) {
          var files = parsleyInstance.$element[0].files;
          if (!files.length) return true;
          var ext = files[0].name.split(".").pop().toLowerCase();
          var allowed = allowedTypes
            .split(",")
            .map((e) => e.trim().toLowerCase()); // trim tut unnötige leerzeichen wegmachen und e für das aktuelle element.
          return allowed.includes(ext); // allowed = erlaubte dateiendung und ext = endung der Dateien
        },
        requirementType: "string",
        messages: { en: "This file must be a PNG or JPG image" },
      });
    </script>
  </body>
</html>
